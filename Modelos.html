<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.80">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Sergio Alejandro Buitrago Melo">
  <meta name="author" content="María Alejandra Cabra Arias">
  <meta name="author" content="María Paula Camargo Rincón">
  <title>Algoritmo de Fisher Scoring</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="Modelos_files/libs/clipboard/clipboard.min.js"></script>
  <script src="Modelos_files/libs/quarto-html/quarto.js"></script>
  <script src="Modelos_files/libs/quarto-html/popper.min.js"></script>
  <script src="Modelos_files/libs/quarto-html/tippy.umd.min.js"></script>
  <script src="Modelos_files/libs/quarto-html/anchor.min.js"></script>
  <link href="Modelos_files/libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="Modelos_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="Modelos_files/libs/bootstrap/bootstrap.min.js"></script>
  <link href="Modelos_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="Modelos_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">
<header id="title-block-header" class="quarto-title-block default">




<div class="quarto-title"><h1 class="title display-7">Algoritmo de Fisher Scoring</h1></div><div class="quarto-title-meta"><div><div class="quarto-title-meta-heading">Authors</div><div class="quarto-title-meta-contents"><div class="quarto-title-authors"><p>Sergio Alejandro Buitrago Melo</p><p>María Alejandra Cabra Arias</p><p>María Paula Camargo Rincón</p></div></div></div></div></header>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("GGally", repos = "http://cran.r-project.org")</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="regresión-poisson" class="level2">
<h2 class="anchored" data-anchor-id="regresión-poisson">Regresión Poisson</h2>
<ul>
<li>Sean <span class="math inline">\(Y_1, Y_2, \cdots, Y_n\)</span> variables aleatorias independientes con distribución <em>Poisson</em>, tales que</li>
</ul>
<p><span class="math display">\[Y_i \sim Poisson(\mu_i) \quad i=1,2,\cdots,n.\]</span> Sabemos que en la distribución <em>Poisson</em>, el parámetro canónico está dado por <span class="math inline">\(\theta_i = \ln(\mu_i)\)</span>.</p>
<p>En el contexto de un modelo de regresión, el predictor lineal <span class="math inline">\(\eta_i\)</span> está dado por</p>
<p><span class="math display">\[\eta_i = \beta_0 + \beta_1X_1 + \beta_2X_2 + \cdots + \beta_pX_p,\]</span> y la relación entre el predictor <span class="math inline">\(\eta_i\)</span> y la media <span class="math inline">\(\mu_i\)</span> está dada por</p>
<p><span class="math display">\[\eta_i = \ln(\mu_i) \Rightarrow \mu_i = \exp(\eta_i).\]</span></p>
<p>La función de log-verosimilitud es como sigue</p>
<p><span class="math display">\[
\begin{align*}
\mathcal{l}(\beta) &amp;= \sum_{i=1}^n \left[y_i\ln(\mu_i) - \mu_i - \ln(y_i!)\right]\\
&amp;= \sum_{i=1}^n \left[y_i x_i^t \beta - \exp(x_i^t \beta) - \ln(y_i!)\right]
\end{align*}
\]</span></p>
<p>La <strong>función score</strong> (vector de primeras derivadas) está dado por</p>
<p><span class="math display">\[\frac{\partial \mathcal{l}(\beta)}{\partial \beta} = \sum_{i=1}^n (y_i - \mu_i)x_i.\]</span> La <strong>Matriz de Información de Fisher</strong> es como sigue</p>
<p><span class="math display">\[\mathcal{J}(\beta) = Inf = X^tWX\]</span> donde</p>
<p><span class="math display">\[W = diag\left(\frac{\left(\frac{\partial \mu_i}{\partial \eta_i}\right)^2}{Var(y_i)}\right)\]</span> <span class="math display">\[\frac{\partial \mu_i}{\partial \eta_i} = \mu_i, \quad \quad \quad \frac{\partial \eta_i}{\partial \mu_i} = \frac{1}{\mu_i}\]</span> Como en la distribución <em>Poisson</em>, <span class="math inline">\(Var(Y_i) = \mu_i\)</span>, se tiene que</p>
<p><span class="math display">\[w_{ii} = \frac{\mu_i^2}{\mu_i} =\mu_i\]</span> y la variable ajustada <span class="math inline">\(\widetilde{y}\)</span> está dada por <span class="math display">\[\widetilde{y} = \eta_i + (y_i - \mu_i)\frac{\partial \eta_i}{\partial \mu_i} = \eta_i + (y_i - \mu_i)\frac{1}{\mu_i}\]</span></p>
<p>De esta forma, el <strong>Algoritmo de Fisher-Scoring</strong> queda determinado por los siguientes pasos:</p>
<ol type="1">
<li>Iniciar el algoritmo con un valor inicial para <span class="math inline">\(\beta\)</span>. Se usará una estimación inicial de <span class="math inline">\(\beta_0^{(0)}\)</span> usando la media global de <span class="math inline">\(y\)</span>.</li>
</ol>
<p><span class="math display">\[
\beta_0^{(0)} = \log\left(\frac{1}{n}\sum_{i=1}^n y_i\right), \quad
\beta_1^{(0)} = 0, \quad \cdots, \quad
\beta_p^{(0)} = 0.
\]</span></p>
<ol start="2" type="1">
<li>obtener <span class="math inline">\(\beta^{(k+1)}\)</span> a partir de <span class="math inline">\(\beta^{(k)}\)</span> usando la siguiente expresión</li>
</ol>
<p><span class="math display">\[\beta^{(k+1)} = \left(X^tW^{(k)}X\right)^{-1}X^tW^{(k)}\widetilde{y}\]</span></p>
<ol start="3" type="1">
<li>repetir <strong>(2)</strong> hasta satisfacer un criterio de convergencia. El criterio de convergencia que se usará en este caso es el siguiente</li>
</ol>
<p><span class="math display">\[\|\beta^{(k+1)} - \beta^{(k)}\| &lt; \epsilon, \quad \quad \epsilon=0.0000001\]</span></p>
<p>A continuación se presenta el algoritmo para encontrar una aproximación de <span class="math inline">\(\beta\)</span> usando datos reales.</p>
<p>Datos de jugadores de baloncesto de la temporada 2022-2023, los cuales incluyen la edad del jugador (AGE), tiempo en minutos jugado en la temporada (MIN), juegos participados (GP), tiros de campo hechos (FGM), tiros de campo intentados (FGA), tiros de campo hechos de 3 puntos (FG3M), tiros de campo intentados de 3 puntos (FGA) y puntos realizados en la temporada (PTS).</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>players <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"players_202223.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AGE, MIN, GP, FGM, FGA, FG3M, FG3A, FTM, FTA, PTS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>players <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"cor"</span>, <span class="at">size =</span> <span class="dv">3</span>)),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"barDiag"</span>, <span class="at">colour =</span> <span class="st">"burlywood"</span>)),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"points"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">shape =</span> <span class="dv">20</span>, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">fill =</span> <span class="st">"lightblue"</span>)),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabels =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Modelos_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>En la matriz de dispersión realizada se usó el coeficiente de correlación de Pearson, el cuál nos muestra que la mayoría de las variables tienen una alta correlación lineal con la variable respuesta, puntos realizados en la temporada (PTS).</p>
<p>Se puede evidenciar que entre las variables tambien se presentan algunas correlaciones casi perfectas, como se presentan entre las variables FGM y FGA, FG3M y FG3A, y FTM y FTA, lo cual tiene sentido ya que los pares de variables mencionadas deberían estar relacionadas entre sí, ya que a nivel general una variable es el número de intentos totales de tiros, mientras que la otra es cuántos de esos tiros lograron ser encestados.</p>
<p>Por otro lado se logra ver una baja correlación lineal entre la variable AGE y el resto de variables, incluyendo la variable respuesta PTS, además de esto en los gráficos de dispersión no se puede evidenciar ningún tipo de correlación entre las variables mencionadas, puesto que los datos son bastante dispersos.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(players <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">last_col</span>()))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>x1)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> players<span class="sc">$</span>PTS</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1040</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de la función</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>fisher_scoring_poisson <span class="ot">&lt;-</span> <span class="cf">function</span>(y, X, beta_init, <span class="at">tol =</span> <span class="fl">1e-7</span>, <span class="at">max_iter =</span> <span class="dv">100</span>){</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> beta_init</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>max_iter){</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    eta <span class="ot">&lt;-</span> X <span class="sc">%*%</span> beta</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> <span class="fu">exp</span>(eta)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    W <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>(mu))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">&lt;-</span> eta <span class="sc">+</span> (y <span class="sc">-</span> mu) <span class="sc">/</span> mu</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    beta_new <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> W <span class="sc">%*%</span> X) <span class="sc">%*%</span> (<span class="fu">t</span>(X) <span class="sc">%*%</span> W <span class="sc">%*%</span> z)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">max</span>(<span class="fu">abs</span>(beta_new <span class="sc">-</span> beta)) <span class="sc">&lt;</span> tol) {</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"Convergió en la iteración "</span>, iter)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">as.vector</span>(beta_new))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> beta_new</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"No convergió"</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.vector</span>(beta))</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Ejecutamos</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>beta_est <span class="ot">&lt;-</span> <span class="fu">fisher_scoring_poisson</span>(<span class="at">y =</span> y, <span class="at">X =</span> X, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">beta_init =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="fu">mean</span>(y)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(X)<span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">max_iter =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Convergió en la iteración 7</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(beta_est) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>beta_est</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>  (Intercept)         x1AGE         x1MIN          x1GP         x1FGM 
 4.1116424116  0.0076175147  0.0000747274  0.0181945865  0.0019076539 
        x1FGA        x1FG3M        x1FG3A         x1FTM         x1FTA 
 0.0002784068  0.0036404818 -0.0011454886  0.0001737093  0.0002852445 </code></pre>
</div>
</div>
<p>Estimación de los parámetros usando la función <code>glm</code> del paquete <code>stats</code></p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>modelo_poisson <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> X <span class="sc">-</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>modelo_poisson<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code> X(Intercept)        Xx1AGE        Xx1MIN         Xx1GP        Xx1FGM 
 4.1116424116  0.0076175147  0.0000747274  0.0181945865  0.0019076539 
       Xx1FGA       Xx1FG3M       Xx1FG3A        Xx1FTM        Xx1FTA 
 0.0002784068  0.0036404818 -0.0011454886  0.0001737093  0.0002852445 </code></pre>
</div>
</div>
<p>En la siguiente tabla se puede ver la comparación con ambos métodos:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">fisher_scoring_poisson</th>
<th style="text-align: center;">glm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_0} = 4.111\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_0} = 4.112\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_1} = 0.007617\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_1} = 0.007618\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_2} = 0.00007472\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_2} = 0.00007473\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_3} = 0.01819\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_3} = 0.01819\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_4} = 0.001907\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_4} = 0.001908\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_5} = 0.0002784\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_5} = 0.0002784\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_6} = 0.003640\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_6} = 0.003640\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_7} = -0.001145\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_7} = -0.001145\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_8} = 0.0001737\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_8} = 0.0001737\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_9} = 0.0002852\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_9} = 0.0002852\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="regresión-binomial" class="level2">
<h2 class="anchored" data-anchor-id="regresión-binomial">Regresión Binomial</h2>
<ul>
<li><p>Sean <span class="math inline">\(Y_1, Y_2, \cdots, Y_n\)</span> variables aleatorias independientes con distribución <em>Binomial</em>, tales que</p>
<p><span class="math display">\[Y_i \sim Binomial(n_i, p_i) \quad i=1,2,\cdots,n.\]</span> donde <span class="math inline">\(n_i\)</span> es el número de ensayos (conocido) para la observación <span class="math inline">\(i\)</span>, y <span class="math inline">\(p_i\)</span> es la probabilidad de éxito. La variable <span class="math inline">\(Y_i\)</span> representa el número de éxitos en los <span class="math inline">\(n_i\)</span> ensayos.</p></li>
<li><p>La media de <span class="math inline">\(Y_i\)</span> es <span class="math inline">\(\mu_i = E[Y_i] = n_i p_i\)</span>.</p></li>
<li><p>La función de enlace canónica (y más común) para la probabilidad <span class="math inline">\(p_i\)</span> es la <strong>logit</strong>:</p>
<p><span class="math display">\[\eta_i = logit(p_i) = \ln\left(\frac{p_i}{1-p_i}\right)\]</span> donde <span class="math inline">\(\eta_i\)</span> es el predictor lineal: <span class="math display">\[\eta_i = \beta_0 + \beta_1X_{i1} + \beta_2X_{i2} + \cdots + \beta_pX_{ip} = x_i^T \beta\]</span></p></li>
<li><p>La relación inversa, que expresa la probabilidad <span class="math inline">\(p_i\)</span> en función del predictor lineal, es la <strong>función logística</strong>: <span class="math display">\[p_i = \frac{e^{\eta_i}}{1+e^{\eta_i}}\]</span> Y por lo tanto, la media <span class="math inline">\(\mu_i\)</span> se relaciona con <span class="math inline">\(\eta_i\)</span> a través de: <span class="math display">\[\mu_i = n_i p_i = n_i \frac{e^{\eta_i}}{1+e^{\eta_i}}\]</span></p></li>
<li><p>La función de log-verosimilitud (ignorando términos constantes como <span class="math inline">\(\ln\binom{n_i}{y_i}\)</span>) es: <span class="math display">\[
\begin{align*}
\mathcal{l}(\beta) &amp;= \sum_{i=1}^n \left[y_i\ln(p_i) + (n_i - y_i)\ln(1-p_i)\right]\\
&amp;= \sum_{i=1}^n \left[y_i \eta_i - n_i \ln(1+e^{\eta_i})\right] \\
&amp;= \sum_{i=1}^n \left[y_i (x_i^T \beta) - n_i \ln(1+\exp(x_i^T \beta))\right]
\end{align*}
\]</span></p></li>
<li><p>La <strong>función score</strong> (vector de primeras derivadas) se puede derivar y resulta ser: <span class="math display">\[\frac{\partial \mathcal{l}(\beta)}{\partial \beta} = \sum_{i=1}^n (y_i - n_i p_i)x_i = \sum_{i=1}^n (y_i - \mu_i)x_i = X^t(y - \mu)\]</span></p></li>
<li><p>La <strong>Matriz de Información de Fisher</strong> es <span class="math inline">\(I(\beta) = X^tWX\)</span>, donde <span class="math inline">\(W\)</span> es una matriz diagonal. Para calcular los elementos <span class="math inline">\(w_{ii}\)</span> de <span class="math inline">\(W\)</span>, necesitamos la varianza <span class="math inline">\(Var(Y_i)\)</span> y la derivada <span class="math inline">\(d\mu_i / d\eta_i\)</span>: <span class="math display">\[Var(Y_i) = n_i p_i (1-p_i)\]</span> <span class="math display">\[\frac{\partial \mu_i}{\partial \eta_i} = \frac{\partial (n_i p_i)}{\partial \eta_i} = n_i \frac{\partial p_i}{\partial \eta_i} = n_i \frac{e^{\eta_i}}{(1+e^{\eta_i})^2} = n_i p_i (1-p_i)\]</span> Entonces, los pesos son: <span class="math display">\[w_{ii} = \frac{\left(\frac{\partial \mu_i}{\partial \eta_i}\right)^2}{Var(y_i)} = \frac{(n_i p_i (1-p_i))^2}{n_i p_i (1-p_i)} = n_i p_i (1-p_i)\]</span></p></li>
<li><p>Nuestro <span class="math inline">\(\widetilde{y}\)</span> para el algoritmo Fisher Scoring es: <span class="math display">\[\widetilde{y} = \eta_i + (y_i - \mu_i)\frac{\partial \eta_i}{\partial \mu_i}\]</span> Dado que <span class="math inline">\(\frac{\partial \eta_i}{\partial \mu_i} = \left(\frac{\partial \mu_i}{\partial \eta_i}\right)^{-1} = \frac{1}{n_i p_i (1-p_i)}\)</span>, tenemos: <span class="math display">\[\widetilde{y} = \eta_i + \frac{y_i - \mu_i}{n_i p_i (1-p_i)}\]</span></p></li>
<li><p>El <strong>Algoritmo de Fisher-Scoring</strong> para la regresión binomial (logit) es:</p>
<ol type="1">
<li>Iniciar con un valor <span class="math inline">\(\beta^{(0)}\)</span>.</li>
<li>Obtener <span class="math inline">\(\beta^{(k+1)}\)</span> a partir de <span class="math inline">\(\beta^{(k)}\)</span> usando:
<ol type="a">
<li>Calcular <span class="math inline">\(\eta^{(k)} = X \beta^{(k)}\)</span>.</li>
<li>Calcular <span class="math inline">\(p^{(k)}_i = 1 / (1 + \exp(-\eta^{(k)}_i))\)</span>.</li>
<li>Calcular <span class="math inline">\(\mu^{(k)}_i = n_i p^{(k)}_i\)</span>.</li>
<li>Calcular pesos <span class="math inline">\(w^{(k)}_{ii} = n_i p^{(k)}_i (1-p^{(k)}_i)\)</span>. Formar <span class="math inline">\(W^{(k)}\)</span>.</li>
<li>Calcular <span class="math inline">\(\widetilde{y}^{(k)}_i = \eta^{(k)}_i + (y_i - \mu^{(k)}_i) / w^{(k)}_{ii}\)</span>. Formar <span class="math inline">\(\widetilde{y}^{(k)}\)</span>.</li>
<li>Actualizar <span class="math inline">\(\beta^{(k+1)} = \left(X^tW^{(k)}X\right)^{-1}X^tW^{(k)}\widetilde{y}^{(k)}\)</span>.</li>
</ol></li>
<li>Repetir el paso (2) hasta la convergencia.</li>
</ol></li>
</ul>
<p>A continuación, adaptaremos el algoritmo para un caso binomial usando datos generados por simulación.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Población binomial</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1040</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulación de datos</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>xbin <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> xbin)  <span class="co"># Incluye intercepto automáticamente</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> X2 <span class="sc">%*%</span> beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset simulado</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">&lt;-</span> <span class="fu">exp</span>(eta)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(eta))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>yb <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  yb[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>,<span class="at">size =</span> <span class="dv">1</span>,<span class="at">prob =</span> pi[i])</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>data_bin <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">y =</span> yb, <span class="at">x =</span> xbin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de la función</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>fisher_scoring_binomial <span class="ot">&lt;-</span> <span class="cf">function</span>(y, X, beta_init, <span class="at">tol =</span> <span class="fl">1e-5</span>, <span class="at">max_iter =</span> <span class="dv">100</span>) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> beta_init</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>max_iter) {</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    eta <span class="ot">&lt;-</span> X <span class="sc">%*%</span> beta</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    eta <span class="ot">&lt;-</span> <span class="fu">pmin</span>(eta, <span class="dv">700</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    eta <span class="ot">&lt;-</span> <span class="fu">pmax</span>(eta, <span class="sc">-</span><span class="dv">700</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    pi <span class="ot">&lt;-</span> <span class="fu">exp</span>(eta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(eta))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    W <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>(pi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> pi)))</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">&lt;-</span> eta <span class="sc">+</span> (y <span class="sc">-</span> pi) <span class="sc">/</span> (pi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> pi))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    beta_new <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> W <span class="sc">%*%</span> X) <span class="sc">%*%</span> (<span class="fu">t</span>(X) <span class="sc">%*%</span> W <span class="sc">%*%</span> z)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Fallo al invertir la matriz. ¿X tiene multicolinealidad?"</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">max</span>(<span class="fu">abs</span>(beta_new <span class="sc">-</span> beta), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&lt;</span> tol) {</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"Convergió en iteración "</span>, iter)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">as.vector</span>(beta_new))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> beta_new</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"No convergió"</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.vector</span>(beta))</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>beta_binomial <span class="ot">&lt;-</span> <span class="fu">fisher_scoring_binomial</span>(<span class="at">y =</span> yb, <span class="at">X =</span> X2, </span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">beta_init =</span> <span class="fu">rep</span>(<span class="fl">0.01</span>, <span class="fu">ncol</span>(X2)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Convergió en iteración 7</code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(beta_binomial) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X2)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>beta_binomial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>(Intercept)        xbin 
  0.6978429   0.4927746 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>modelo_logistico <span class="ot">&lt;-</span> <span class="fu">glm</span>(yb <span class="sc">~</span> X2 <span class="sc">-</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>modelo_logistico<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>X2(Intercept)        X2xbin 
    0.6978430     0.4927746 </code></pre>
</div>
</div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">fisher_scoring_binomial</th>
<th style="text-align: center;">glm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_0} = 0.6978429\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_0} = 0.6978430\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_1} = 0.4927746\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\hat{\beta_1} = 0.4927746\)</span></td>
</tr>
</tbody>
</table>
<p>A continución se hará uso de algunos datos obtenidos sobre unos tratamientos al agua, de los cuales la variable respuesta será si se le aplicó o no polímero:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>TURB<span class="ot">=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">250</span>,<span class="dv">190</span>,<span class="dv">160</span>,<span class="dv">560</span>,<span class="dv">150</span>,<span class="dv">160</span>,<span class="dv">270</span>,<span class="dv">450</span>,<span class="dv">210</span>,<span class="dv">420</span>,<span class="dv">550</span>,<span class="dv">1200</span>,<span class="dv">420</span>,<span class="dv">500</span>,<span class="dv">150</span>,<span class="dv">200</span>,<span class="dv">390</span>,<span class="dv">380</span>,<span class="dv">140</span>,<span class="dv">170</span>,<span class="dv">1110</span>,<span class="dv">140</span>,<span class="dv">150</span>,<span class="dv">870</span>,<span class="dv">720</span>,<span class="dv">430</span>,<span class="dv">550</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>COL<span class="ot">=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">50</span>,<span class="dv">70</span>,<span class="dv">200</span>,<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">70</span>,<span class="dv">130</span>,<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">250</span>,<span class="dv">250</span>,<span class="dv">100</span>,<span class="dv">120</span>,<span class="dv">75</span>,<span class="dv">50</span>,<span class="dv">140</span>,<span class="dv">120</span>,<span class="dv">50</span>,<span class="dv">110</span>,<span class="dv">100</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">150</span>,<span class="dv">200</span>,<span class="dv">100</span>,<span class="dv">200</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ALCA<span class="ot">=</span><span class="fu">c</span>(<span class="dv">49</span>,<span class="dv">43</span>,<span class="dv">51</span>,<span class="dv">52</span>,<span class="dv">44</span>,<span class="dv">48</span>,<span class="dv">55</span>,<span class="dv">43</span>,<span class="dv">56</span>,<span class="dv">51</span>,<span class="dv">46</span>,<span class="dv">65</span>,<span class="dv">43</span>,<span class="dv">53</span>,<span class="dv">48</span>,<span class="dv">45</span>,<span class="dv">52</span>,<span class="dv">52</span>,<span class="dv">39</span>,<span class="dv">54</span>,<span class="dv">52</span>,<span class="dv">51</span>,<span class="dv">55</span>,<span class="dv">50</span>,<span class="dv">49</span>,<span class="dv">44</span>,<span class="dv">48</span>,<span class="dv">40</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>PH<span class="ot">=</span><span class="fu">c</span>(<span class="fl">8.33</span>,<span class="fl">7.64</span>,<span class="fl">7.62</span>,<span class="fl">7.62</span>,<span class="fl">8.19</span>,<span class="fl">7.90</span>,<span class="fl">7.60</span>,<span class="fl">8.07</span>,<span class="fl">7.53</span>,<span class="fl">7.72</span>,<span class="fl">7.90</span>,<span class="fl">7.68</span>,<span class="fl">7.93</span>,<span class="fl">7.90</span>,<span class="fl">8.01</span>,<span class="fl">7.71</span>,<span class="fl">7.66</span>,<span class="fl">8.09</span>,<span class="fl">8.17</span>,<span class="fl">8.16</span>,<span class="fl">7.58</span>,<span class="fl">8.06</span>,<span class="fl">7.51</span>,<span class="fl">7.56</span>,<span class="fl">7.60</span>,<span class="fl">8.18</span>,<span class="fl">7.20</span>,<span class="fl">7.55</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>TEM<span class="ot">=</span><span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">27</span>,<span class="dv">28</span>,<span class="dv">26</span>,<span class="dv">25</span>,<span class="dv">26</span>,<span class="dv">26</span>,<span class="dv">24</span>,<span class="dv">27</span>,<span class="dv">27</span>,<span class="dv">26</span>,<span class="dv">27</span>,<span class="dv">26</span>,<span class="dv">26</span>,<span class="dv">27</span>,<span class="dv">27</span>,<span class="dv">26</span>,<span class="dv">27</span>,<span class="dv">26</span>,<span class="dv">25</span>,<span class="dv">27</span>,<span class="dv">23</span>,<span class="dv">27</span>,<span class="dv">27</span>,<span class="dv">27</span>,<span class="dv">23</span>,<span class="dv">26</span>,<span class="dv">27</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>POL<span class="ot">=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>Xbin2 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> TURB<span class="sc">+</span>COL<span class="sc">+</span>ALCA<span class="sc">+</span>PH<span class="sc">+</span>TEM)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher_scoring_binomial</span>(<span class="at">y =</span> POL,<span class="at">X =</span> Xbin2,<span class="at">beta_init =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="fu">mean</span>(POL)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">mean</span>(POL))), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(Xbin2)<span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">max_iter =</span> <span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Convergió en iteración 9</code></pre>
</div>
<div class="cell-output-stdout">
<pre><code>[1] 79.20147632  0.02551354 -0.02288018  0.06790235 -7.21260865 -1.32268428</code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mode1<span class="ot">&lt;-</span><span class="fu">glm</span>(<span class="at">formula =</span> POL <span class="sc">~</span> TURB<span class="sc">+</span>PH, <span class="at">family =</span> binomial)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>mode2<span class="ot">&lt;-</span><span class="fu">glm</span>(<span class="at">formula =</span> POL <span class="sc">~</span> TURB, <span class="at">family =</span> binomial)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mode1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Call:
glm(formula = POL ~ TURB + PH, family = binomial)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)  
(Intercept) 26.249979  21.551607   1.218   0.2232  
TURB         0.015946   0.006413   2.487   0.0129 *
PH          -4.319902   2.869008  -1.506   0.1321  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 35.165  on 27  degrees of freedom
Residual deviance: 12.191  on 25  degrees of freedom
AIC: 18.191

Number of Fisher Scoring iterations: 7</code></pre>
</div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mode2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Call:
glm(formula = POL ~ TURB, family = binomial)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)  
(Intercept) -6.552847   2.664456  -2.459   0.0139 *
TURB         0.013816   0.005922   2.333   0.0196 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 35.165  on 27  degrees of freedom
Residual deviance: 15.394  on 26  degrees of freedom
AIC: 19.394

Number of Fisher Scoring iterations: 7</code></pre>
</div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>r1<span class="ot">=</span><span class="fu">resid</span>(mode1, <span class="at">type=</span><span class="st">'deviance'</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>r2<span class="ot">=</span><span class="fu">resid</span>(mode2, <span class="at">type=</span><span class="st">'deviance'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</main>
<!-- /main column -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->


</body></html>